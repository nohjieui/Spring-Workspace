<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="chattingMapper">

	<resultMap type="chatRoom" id="chatRoomResultSet">
		<result column="CHAT_ROOM_NO" property="chatRoomNo"/>
		<result column="TITLE" property="title"/>
		<result column="NICK_NAME" property="nickName"/>
		<result column="CNT" property="cnt"/>

		<result column="USER_NO" property="userNo"/>
		<result column="STATUS" property="status"/>
	</resultMap>
	
	<select id="selectChatRoomList" resultMap="chatRoomResultSet">
		SELECT
			CHAT_ROOM_NO,
			TITLE,
			NICK_NAME,
			(SELECT COUNT(*)
			   FROM CHAT_ROOM_JOIN B
			  WHERE B.CHAT_ROOM_NO = A.CHAT_ROOM_NO) CNT
		  FROM CHAT_ROOM A
		  JOIN MEMBER M USING (USER_NO)
		 WHERE A.STATUS = 'Y'
		 ORDER BY CHAT_ROOM_NO DESC
	</select>
</mapper>
